import*as THREE from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{vertexShader,fluidShader,displayShader}from"../../js/index/shader.js";let config={brushSize:25,brushStrength:.5,distortionAmount:2.5,fluidDecay:.98,trailLenght:.8,stopDecay:.85,color1:"#b8fff7",color2:"#6e3466",color3:"#0133ff",color4:"#66d1fe",colorIntensity:1,softness:1};function hextoRgb(e){return[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255]}let camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),renderer=new THREE.WebGLRenderer({antialias:!0}),gradientCanvas=document.querySelector(".gradient-canvas"),fluidTarget1=(renderer.setSize(window.innerWidth,window.innerHeight),gradientCanvas.appendChild(renderer.domElement),new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType})),fluidTarget2=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),currentFluidTarget=fluidTarget1,previousFluidTarget=fluidTarget2,frameCount=0,fluidMaterial=new THREE.ShaderMaterial({uniforms:{iTime:{value:0},iResolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},iMouse:{value:new THREE.Vector4(0,0,0,0)},iFrame:{value:0},iPreviousFrame:{value:null},uBrushSize:{value:config.brushSize},uBrushStrength:{value:config.brushStrength},uFluidDecay:{value:config.fluidDecay},uTrailLenght:{value:config.trailLenght},uStopDecay:{value:config.stopDecay}},vertexShader:vertexShader,fragmentShader:fluidShader}),displayMaterial=new THREE.ShaderMaterial({uniforms:{iTime:{value:0},iResolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},iFluid:{value:null},uDistortionAmount:{value:config.distortionAmount},uColor1:{value:new THREE.Vector3(...hextoRgb(config.color1))},uColor2:{value:new THREE.Vector3(...hextoRgb(config.color2))},uColor3:{value:new THREE.Vector3(...hextoRgb(config.color3))},uColor4:{value:new THREE.Vector3(...hextoRgb(config.color4))},uColorIntensity:{value:config.colorIntensity},uSoftness:{value:config.softness}},vertexShader:vertexShader,fragmentShader:displayShader}),geometry=new THREE.PlaneGeometry(2,2),fluidPlane=new THREE.Mesh(geometry,fluidMaterial),displayPlane=new THREE.Mesh(geometry,displayMaterial),mouseX=0,mouseY=0,prevMouseX=0,prevMouseY=0,lastMoveTime=0;function animate(){requestAnimationFrame(animate);var e=.001*performance.now(),e=(fluidMaterial.uniforms.iTime.value=e,displayMaterial.uniforms.iTime.value=e,fluidMaterial.uniforms.iFrame.value=frameCount,100<performance.now()-lastMoveTime&&fluidMaterial.uniforms.iMouse.value.set(0,0,0,0),fluidMaterial.uniforms.uBrushSize.value=config.brushSize,fluidMaterial.uniforms.uBrushStrength.value=config.brushStrength,fluidMaterial.uniforms.uFluidDecay.value=config.fluidDecay,fluidMaterial.uniforms.uTrailLenght.value=config.trailLenght,fluidMaterial.uniforms.uStopDecay.value=config.stopDecay,displayMaterial.uniforms.uDistortionAmount.value=config.distortionAmount,displayMaterial.uniforms.uColorIntensity.value=config.colorIntensity,displayMaterial.uniforms.uSoftness.value=config.softness,displayMaterial.uniforms.uColor1.value.set(...hextoRgb(config.color1)),displayMaterial.uniforms.uColor2.value.set(...hextoRgb(config.color2)),displayMaterial.uniforms.uColor3.value.set(...hextoRgb(config.color3)),displayMaterial.uniforms.uColor4.value.set(...hextoRgb(config.color4)),fluidMaterial.uniforms.iPreviousFrame.value=previousFluidTarget.texture,renderer.setRenderTarget(currentFluidTarget),renderer.render(fluidPlane,camera),displayMaterial.uniforms.iFluid.value=currentFluidTarget.texture,renderer.setRenderTarget(null),renderer.render(displayPlane,camera),currentFluidTarget);currentFluidTarget=previousFluidTarget,previousFluidTarget=e,frameCount++}document.addEventListener("mousemove",e=>{var r=gradientCanvas.getBoundingClientRect();prevMouseX=mouseX,prevMouseY=mouseY,mouseX=e.clientX-r.left,mouseY=r.height-(e.clientY-r.top),lastMoveTime=performance.now(),fluidMaterial.uniforms.iMouse.value.set(mouseX,mouseY,prevMouseX,prevMouseY)}),document.addEventListener("mouseleave",e=>{fluidMaterial.uniforms.iMouse.value.set(0,0,0,0)}),window.addEventListener("resize",()=>{var e=window.innerWidth,r=window.innerHeight;renderer.setSize(e,r),fluidMaterial.uniforms.iResolution.value.set(e,r),displayMaterial.uniforms.iResolution.value.set(e,r),fluidTarget1.setSize(e,r),fluidTarget2.setSize(e,r),frameCount=0}),animate();